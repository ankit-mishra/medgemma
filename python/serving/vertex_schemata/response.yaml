# Copyright 2025 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

title: MedGemmaChatCompletionResponse
description: >
  The schema for a MedGemma chat completion response, which can be either a successful
  completion or an error. It aligns with the core functionality of the OpenAI Chat
  Completion API: https://platform.openai.com/docs/api-reference/chat/object
oneOf:
  - $ref: '#/components/schemas/ChatCompletionSuccessResponse'
  - $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    ChatCompletionSuccessResponse:
      title: ChatCompletionSuccessResponse
      type: object
      additionalProperties: false
      description: The schema for a successful chat completion response.
      required:
        - id
        - object
        - created
        - model
        - choices
      properties:
        id:
          type: string
          description: A unique identifier for the chat completion.
        object:
          type: string
          description: The object type, which is always "chat.completion".
          enum:
            - chat.completion
          default: chat.completion
        created:
          type: integer
          description: The Unix timestamp (in seconds) of when the chat completion was created.
        model:
          type: string
          description: The model used for the chat completion.
        choices:
          type: array
          items:
            $ref: '#/components/schemas/ChatCompletionResponseChoice'
          description: >
            A list of chat completion choices. Can be more than one if n is greater than 1.
        usage:
          $ref: '#/components/schemas/UsageInfo'
          description: Usage statistics for the completion request.

    ErrorResponse:
      title: ErrorResponse
      type: object
      required:
        - error
      additionalProperties: false
      description: >
        The schema for an error response, wrapping the error details in an 'error' object. Inspired
        by the OpenAI API errors minus the `code`, `status`, and `param` fields.
      properties:
        error:
          type: object
          additionalProperties: false
          required:
            - message
            - object
            - type
          properties:
            message:
              type: string
              description: A human-readable description of the error.
              maxLength: 1024
            object:
              type: string
              description: The object type, which is always "error".
              enum:
                - error
            type:
              type: string
              description: A string categorizing the error type (e.g., 'BadRequestError').
              enum:
                - BadRequestError
                - TransientServerError
                - PermanentServerError

    ChatCompletionResponseChoice:
      title: ChatCompletionResponseChoice
      type: object
      additionalProperties: false
      description: Represents one of the possible completion choices generated by the model.
      properties:
        index:
          type: integer
          description: The index of the choice in the list of choices.
        message:
          $ref: '#/components/schemas/ChatMessage'
          description: A chat completion message generated by the model.
        logprobs:
          $ref: '#/components/schemas/ChatCompletionLogProbs'
          description: >
            Log probability information for the choice. This is null if logprobs is not requested.
        finish_reason:
          type: string
          description: >
            The reason the model stopped generating tokens. This will be stop if the model hit a
            natural stop point or a provided stop sequence, length if the maximum number of tokens
            specified in the request was reached, or content_filter if content was omitted due to a
            flag from our content filters.
          enum:
            - stop
            - length
            - content_filter

    ChatMessage:
      title: ChatMessage
      type: object
      additionalProperties: false
      description: Represents a single message within a chat conversation.
      required:
        - role
        - content
      properties:
        role:
          type: string
          description: The role of the author of this message.
          enum:
            - system
            - user
            - assistant
        content:
          type: string
          description: The contents of the message.

    TopLogProbs:
      title: TopLogProbs
      type: object
      description: >
        Represents the log probability information for a single token in the top_logprobs list.
      required:
        - token
        - logprob
      properties:
        token:
          type: string
          description: The token.
        logprob:
          type: number
          format: float
          description: The log probability of this token.
        bytes:
          type: array
          items:
            type: integer
          nullable: true
          description: >
            A list of integers representing the UTF-8 bytes of the token. This is only present if
            the token is not a valid UTF-8 string.
      additionalProperties: false

    ChatCompletionLogProbsContent:
      title: ChatCompletionLogProbsContent
      type: object
      description: Represents the log probability information for a token and its top alternatives.
      required:
        - token
        - logprob
      properties:
        token:
          type: string
          description: The generated token.
        logprob:
          type: number
          format: float
          description: The log probability of this token.
        bytes:
          type: array
          items:
            type: integer
          nullable: true
          description: >
            A list of integers representing the UTF-8 bytes of the token. This is only present if
            the token is not a valid UTF-8 string.
        top_logprobs:
          type: array
          items:
            $ref: '#/components/schemas/TopLogProbs'
          nullable: true
          description: >
            List of the most likely tokens and their log probabilities at this token position.
            In most cases, this will be null if logprobs is not greater than 0.
      additionalProperties: false

    ChatCompletionLogProbs:
      title: ChatCompletionLogProbs
      type: object
      description: Log probability information for the chat completion.
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/ChatCompletionLogProbsContent'
          nullable: true
          description: A list of log probability information for each token in the completion.
      additionalProperties: false

    UsageInfo:
      title: UsageInfo
      type: object
      additionalProperties: false
      description: Usage statistics for the chat completion request.
      properties:
        prompt_tokens:
          type: integer
          default: 0
          description: The number of tokens in the prompt.
        total_tokens:
          type: integer
          default: 0
          description: The total number of tokens used in the request (prompt + completion).
        completion_tokens:
          type: integer
          default: 0
          description: The number of tokens in the generated completion.
